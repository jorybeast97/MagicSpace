## OSI七层协议

![](C:\Users\fanhao\Desktop\aa\705728-20160424234824085-667046040.png)

- 物理层 : 主要负责bit流在端与端之间的传输
- 链路层 : 主要解决局域网问题,通过交互机与网卡完成MAC地址的查询
- 网络层 : 通过IP协议将局域网连接到Internet上,路由器位于该层
- 传输层 : 解决进程间通讯的问题,IP协议只能够完成主机的定位,而TCP/UDP协议能够完成进程间的通讯
- 会话层 : 例如当通过协议传输文件时,需要建立一个通讯,这个通讯就是一个会话
- 表示层 : 数组的编解码以及加密等内容
- 应用层 : 使用端口通讯的性质并满足用户的需求,主要由HTTP1.0/1.1/2.0 HTTPS以及Websocket等

![](C:\Users\fanhao\Desktop\aa\协议 (2).png)

OSI七层模型和五层模型主要是提供一种处理问题的策略方案。而互联网中真正使用的则是TCP/IP四层模型,也是对于前两者的具体实现。

## ARP协议

### ARP概述

网络设备有数据要发送给另一台网络设备时，必须要知道对方的网络层地址（即IP地址）。IP地址由网络层来提供，但是仅有IP地址是不够的，IP数据报文必须封装成帧才能通过数据链路进行发送。数据帧必须要包含目的MAC地址，因此发送端还必须获取到目的MAC地址。通过目的IP地址二获取的MAC地址的过程是由ARP（Address Resolution Protocol）协议来实现的。而RARP协议则是能够将MAC地址映射为一个IP地址。

### ARP 工作流程

在任何时候，一台主机有IP数据报文发送给另一台主机，它都要知道接收方的逻辑（IP）地址。但是IP地址必须封装成帧才能通过物理网络。这就意味着发送方必须有接收方的物理（MAC）地址，因此需要完成逻辑地址到物理地址的映射。而ARP协议可以接收来自IP协议的逻辑地址，将其映射为相应的物理地址，然后把物理地址递交给数据链路层。

### ARP请求与响应

当主机需要寻找另一台主机时,会发送ARP请求。由于此时主机只有自己的IP地址和MAC地址以及其目标主机的IP地址,而并不具有对方的MAC地址,所以我们首先需要在局域网中寻找,而这个寻找的过程就是ARP请求。

主机会使用广播的方式向局域网中各个主机发送ARP请求,只有目标主机会响应该请求。这个响应报文包含接收方的IP地址和物理地址。这个报文利用收到的ARP请求报文中的请求方物理地址以单播的方式直接发送给ARP请求报文的请求方。

### ARP数据报文

![](C:\Users\fanhao\Desktop\aa\QQ截图20200515175719.png)



硬件类型：16位字段，用来定义运行ARP的网络类型。每个局域网基于其类型被指派一个整数。例如：以太网的类型为1。ARP可用在任何物理网络上。

协议类型：16位字段，用来定义使用的协议。例如：对IPv4协议这个字段是0800。ARP可用于任何高层协议

硬件长度：8位字段，用来定义物理地址的长度，以字节为单位。例如：对于以太网的值为6。

协议长度：8位字段，用来定义逻辑地址的长度，以字节为单位。例如：对于IPv4协议的值为4。

操作码：16位字段，用来定义报文的类型。已定义的分组类型有两种：ARP请求（1），ARP响应（2）。

源硬件地址：这是一个可变长度字段，用来定义发送方的物理地址。例如：对于以太网这个字段的长度是6字节。

源逻辑地址：这是一个可变长度字段，用来定义发送方的逻辑（IP）地址。例如：对于IP协议这个字段的长度是4字节。

目的硬件地址：这是一个可变长度字段，用来定义目标的物理地址，例如，对以太网来说这个字段位6字节。对于ARP请求报文，这个字段为全0，因为发送方并不知道目标的硬件地址。

## ICMP协议

ICMP协议是为了补充IP协议的不足所存在的。IP协议是不可靠协议,如果发生丢包,并不会通知传输层其情况以及原因。

因此需要在网络层增添一种能够可靠协议,完成一些针对主机IP的操作。

### ICMP内容

1. 确认IP包是否成功到达目标地址
2. 通知在发送过程中IP包被丢弃的原因

ICMP是基于IP协议工作的，但是它并不是传输层的功能，因此仍然把它归结为网络层协议,ICMP只能搭配IPv4使用，如果是IPv6的情况下, 需要是用ICMPv6。

### ICMP作用

ICMP可以用来测试请求,例如我们使用的ping操作就是一个发送ICMP报文的操作。同样也可以用ICMP报文来获取连接的时间戳,例如用来测试一次连接的响应时间。

- ping命令会先发送一个 ICMP Echo Request给对端
- 对端接收到之后, 会返回一个ICMP Echo Reply
- 若没有返回，就是超时了，会认为指定的网络地址不存在

## IP协议

